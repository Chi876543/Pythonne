{% extends 'admin/admin_base_site.html'%}
{% load static %}
{% block title %}Danh sách Đơn hàng{% endblock %}
{% block header_title %}Quản lý Đơn hàng{% endblock %}

{%block table_header%}
    <tr>
        <th>ID</th>
        <th>Tên khách hàng</th>
        <th>Địa chỉ giao hàng</th>
        <th>Ngày đặt hàng</th>
        <th>Ngày xác nhận</th>
        <th>Tổng tiền</th>
        <th>Trạng thái</th>
    </tr>
{% endblock %}
{% block table_body%}
    {%for order in orders%}
        <tr>
            <td>{{order.id}}</td>
            <td>{{order.user.full_name}}</td>
            <td>{{order.address}}</td>
            <td>{{order.created_at}}</td>
            <td>{{order.updated_at}}</td>
            <td>{{order.total_amount}}</td>
            <td>
                <form method="POST" action="{% url 'update_order_status' order.id %}">
                    {% csrf_token %}
                    <select name="status" onchange="this.form.submit()">
                        <option value="Pending" {% if order.status == "Pending" %}selected{% endif %}>Pending</option>
                        <option value="Confirmed" {% if order.status == "Confirmed" %}selected{% endif %}>Confirmed</option>
                        <option value="Cancelled" {% if order.status == "Cancelled" %}selected{% endif %}>Cancelled</option>
                        <option value="Completed" {% if order.status == "Completed" %}selected{% endif %}>Completed</option>
                    </select>
                </form>
            </td>
            {% comment %} <td><a href="{% url 'order_detail' order.id %}">Xem chi tiết</a></td> {% endcomment %}
        </tr>
    {% endfor %}
{%endblock%}
{% block filter_fields %}
    <input type="text" name="customer_name" placeholder="Tìm theo tên khách hàng">
    <label for ="start_date" >Từ ngày</label>
    <input type="date" name="start_date" id="start_date">
    <label for="end_date" >Đến ngày</labe>
    <input type="date" name="end_date" id="end_date">
{% endblock %}

{%block script%}
<script>
    document.getElementById('start_date').addEventListener('change', function () {
        const startDate = this.value;
        const endDateInput = document.getElementById('end_date');

        // Cập nhật ngày tối thiểu có thể chọn cho ngày kết thúc
        endDateInput.min = startDate;

        // Nếu ngày kết thúc hiện tại < ngày bắt đầu → xóa luôn để tránh sai
        if (endDateInput.value && endDateInput.value < startDate) {
            endDateInput.value = '';
        }
    });
    {% for message in messages %}
            alert("{{ message|escapejs }}");
    {% endfor %}
</script>
{%endblock%}

